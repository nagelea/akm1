# Admin页面密钥数量限制说明

## 🔍 问题描述

Admin页面的密钥显示可能受到以下限制：

### 当前限制情况
- **默认显示**: 前 5000 条记录
- **可扩展到**: 前 10000 条记录
- **分页显示**: 每页 20 条记录（可调整为 10/50/100）

### 为什么有限制？

1. **性能考虑**: 
   - 大量数据加载会影响页面响应速度
   - 浏览器内存使用限制
   - 网络传输效率

2. **用户体验**: 
   - 过多数据难以浏览和操作
   - 搜索和筛选功能更适合定位特定密钥

3. **数据库查询优化**:
   - 避免长时间查询锁定
   - 减少服务器资源消耗

## 🛠️ 解决方案

### 1. 智能加载机制

系统会自动检测是否达到限制：

```javascript
// 当显示数据达到5000条时，会出现警告提示
if (keys.length >= 5000) {
  // 显示: "⚠️ 当前显示前 5000 条记录，可能还有更多数据"
  // 提供: "加载更多 (前10000条)" 按钮
}
```

### 2. 高效的搜索和筛选

使用内置搜索功能快速定位：

- **搜索范围**: 仓库名称、文件路径、密钥内容、代码上下文
- **筛选选项**: 密钥类型、严重程度、置信度、验证状态
- **实时筛选**: 在已加载数据中即时筛选

### 3. 分页浏览

- **页面大小选择**: 10/20/50/100 条/页
- **智能导航**: 首页、末页、上一页、下一页
- **记录范围显示**: "显示 1-20 / 共 150 条记录"

## 📊 最佳实践

### 日常使用建议

1. **使用搜索功能**:
   ```
   搜索特定仓库: "organization/repo-name"
   搜索密钥类型: "openai" 或 "groq"
   搜索文件类型: ".py" 或 ".js"
   ```

2. **使用筛选功能**:
   - 只查看高风险密钥: 严重程度 = high
   - 只查看有效密钥: 验证状态 = valid
   - 按服务类型筛选: 密钥类型 = openai

3. **合理设置页面大小**:
   - 快速浏览: 20条/页
   - 详细审查: 10条/页  
   - 批量操作: 50-100条/页

### 管理大量数据

如果你的系统中有超过10000条密钥记录：

1. **定期清理**:
   - 删除已确认无效的密钥
   - 清理重复或过期的记录

2. **使用数据库直接查询**:
   ```sql
   -- 查看总数
   SELECT COUNT(*) FROM leaked_keys;
   
   -- 按类型统计
   SELECT key_type, COUNT(*) 
   FROM leaked_keys 
   GROUP BY key_type 
   ORDER BY COUNT(*) DESC;
   ```

3. **导出数据**:
   - 使用数据库工具导出完整数据
   - 进行离线分析和处理

## 🔧 技术细节

### RPC函数参数

修改后的 `get_keys_with_sensitive_data` 函数支持限制参数：

```sql
-- 获取默认数量 (5000条)
SELECT * FROM get_keys_with_sensitive_data();

-- 获取指定数量
SELECT * FROM get_keys_with_sensitive_data(10000);

-- 获取所有数据 (谨慎使用)
SELECT * FROM get_keys_with_sensitive_data(NULL);
```

### 前端调用

```javascript
// 默认加载
fetchKeys()           // 加载前5000条

// 加载更多
fetchKeys(10000)      // 加载前10000条

// 自定义限制
fetchKeys(1000)       // 加载前1000条
```

## ⚠️ 注意事项

1. **性能影响**: 
   - 加载 10000+ 条记录可能需要 3-5 秒
   - 大量数据会增加内存使用

2. **网络考虑**:
   - 移动网络下建议使用较小的页面大小
   - 弱网环境下优先使用搜索功能

3. **浏览器限制**:
   - 某些浏览器可能在处理大量DOM元素时变慢
   - 建议使用现代浏览器 (Chrome 90+, Firefox 88+)

## 🚀 未来改进

计划中的改进功能：

1. **虚拟滚动**: 支持流畅浏览大量数据
2. **服务端分页**: 更高效的数据加载
3. **高级筛选**: 按时间范围、仓库等更多条件筛选
4. **批量操作**: 支持批量验证、删除等操作
5. **数据导出**: 支持CSV、JSON格式导出

---

**总结**: 当前的5000条限制是为了平衡性能和功能性。对于大多数使用场景，结合搜索和筛选功能已经足够高效地管理API密钥。如需处理更多数据，可以使用"加载更多"功能或直接操作数据库。